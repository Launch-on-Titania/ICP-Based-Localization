<?xml version="1.0" encoding="UTF-8"?>
<launch>
    <arg name="robot_namespace" default="a112138"/>
    <arg name="pcd_filepath" default="$(find icp_localization)/data/urban.pcd" />

    <include file="$(find icp_localization)/launch/icp_node.launch">
        <!-- input topic -->
        <param name="icp_localization/range_data_topic" value="lidar"/>
        <!-- output topic -->
        <param name="icp_localization/odometry_data_topic" value="$(arg robot_namespace)/odom/lidar"/>
        <param name="icp_localization/is_use_odometry" value="true"/>
    </include>
    
    <node name="$(arg robot_namespace)_viso2_ros" pkg="viso2_ros" type="mono_odometer">
        <param name="pose" value="$(arg robot_namespace)/odom/mono_pose"/>
        <!-- input topic -->
        <param name="image" value="camera"/>
        <!-- output topic -->
        <param name="odometry" value="$(arg robot_namespace)/odom/mono_odom"/>
        <param name="base_link_frame_id" value="base_link"/>
        <param name="publish_tf" value="false"/>
        <param name="sensor_frame_id" value="camera"/>
    </node>

    <node name="$(arg robot_namespace)_robot_localization" pkg="robot_localization" type="ekf_localization_node" clear_params="true">
        <rosparam command="load" file="$(find robot_localization)/params/ekf_template.yaml" />
        <param name="base_link_frame" value="base_link"/>
        
        <param name="odom0" value="$(arg robot_namespace)/odom/lidar"/>
        <rosparam param="odom0_config">[true, true, true,
                                    true, true, true,
                                    true, true, true,
                                    true, true, true,
                                    false, false, false]</rosparam>
        
        <param name="odom1" value="$(arg robot_namespace)/odom/rgbd_visual"/>
        <rosparam param="odom1_config">[false, false, false,
                                    true, true, true,
                                    true, true, true,
                                    true, true, true,
                                    false, false, false]</rosparam>

        <param name="use_control" value="false"/>

        <!-- Placeholder for output topic remapping -->
        <remap from="odometry/filtered" to="$(arg robot_namespace)/odom/filtered"/>
    </node>

</launch>